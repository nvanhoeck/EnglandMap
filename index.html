<html>
  <head>
    <meta charset="utf-8" />
    <title>England roadmap</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
   <script src="https://kit.fontawesome.com/90e9580bdf.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" crossorigin="" />
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" crossorigin=""></script>

    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@3.0.10/dist/esri-leaflet.js"></script>

    <!-- Load Esri Leaflet Vector from CDN -->
    <script src="https://unpkg.com/esri-leaflet-vector@4.0.1/dist/esri-leaflet-vector.js" crossorigin=""></script>
    <style>
      html,
      body,
      #map {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 14px;
        color: #323232;
      }
    </style>
  </head>
  <body>
    <div id="gps" class="gps"></div>
    <div class="buttons">
        <a class='btn' href="#" id="location">
            <i class="fab fa fa-user"></i>
        </a>
        <a class='btn' href="#" id="update">
            <i class="fab fa fa-arrow-up"></i>
        </a>
    </div>
    <div id="map"></div>
    <script>
      const apiKey = "AAPK1e49dfb738404c3b98f6104f8fc16e0d5TlIqauPv_BhDBDMfKfG0Ni1ifY98OBzfzC0NMRz6mNQAu3Kepqitio_CaJyw-qe";

      const map = L.map("map").setView([51.12697723187457, 1.3335895828510886], 10);

      L.esri.Vector.vectorBasemapLayer("ArcGIS:ModernAntique:Base", {
        apikey: apiKey,
        pane:"tilePane" // Create the base layer in `tilePane` rather than the default `overlayPane`
      }).addTo(map);

      L.esri.Vector.vectorBasemapLayer("ArcGIS:Topographic", {
        apikey: apiKey
      }).addTo(map);

      //Icons options
      var iconOptions = (size, naamFoto) => ({
        iconUrl: naamFoto + '.png',
        iconSize: [size, size]
      })

      //Marker Options
      var markerOptions = (title, sizeFoto, naamFoto) => ({
            title: title,
            clickable: true,
            icon: L.icon(iconOptions(sizeFoto, naamFoto))
      })

      //Markers
      var schipMarker = new L.Marker([51.12697723187457, 1.3335895828510886  ], markerOptions('Dover', 25, 'schip'));
      schipMarker.addTo(map);

      var goGlampMarker = new L.Marker([51.163790, 0.662626], markerOptions('Go Glamp', 25, 'tent'));
      goGlampMarker.addTo(map);

      var StockbridgeviewMarker = new L.Marker([51.116994, -1.510334], markerOptions('StockbridgeView', 25, 'tent'));
      StockbridgeviewMarker.addTo(map);

      var WoodovisParkMarker = new L.Marker([50.548938013747396, -4.215712085330895], markerOptions('WoodovisPark', 25, 'tent'));
      WoodovisParkMarker.addTo(map);

      var TheCrownInnMarker = new L.Marker([51.375789, -1.948202], markerOptions('TheCrownInn', 25, 'tent'));
      TheCrownInnMarker.addTo(map);

      var BredonValeCaravanCampingMarker = new L.Marker([52.122061, -1.943059], markerOptions('BredonValeCaravanCamping', 25, 'tent'));
      BredonValeCaravanCampingMarker.addTo(map);

      var HideAwayEscapesMarker = new L.Marker([51.805722, -4.723392], markerOptions('HideAwayEscapes', 25, 'tent'));
      HideAwayEscapesMarker.addTo(map);

      var GarthyFogMarker = new L.Marker([52.705752, -4.020562], markerOptions('GarthyFog', 25, 'tent'));
      GarthyFogMarker.addTo(map);

      var PenisarMynyddCaravanParkMarker = new L.Marker([53.282061, -3.360819], markerOptions('PenisarMynyddCaravanpark', 25, 'tent'));
      PenisarMynyddCaravanParkMarker.addTo(map);

      var BlackbrookLodgeCampingAndCaravanningMarker = new L.Marker([53.001042, -1.597239], markerOptions('BlackbrookLodgeCampingAndCaravanning', 25, 'tent'));
      BlackbrookLodgeCampingAndCaravanningMarker.addTo(map);

      var HowgillLodgeMarker = new L.Marker([54.029556, -1.903328], markerOptions('HowgillLodge', 25, 'tent'));
      HowgillLodgeMarker.addTo(map);

      var SykesideCampingparkMarker = new L.Marker([54.498608, -2.924738], markerOptions('SykesideCampingpark', 25, 'tent'));
      SykesideCampingparkMarker.addTo(map);

      var FallowfielDeneCaravanCampingParkMarker = new L.Marker([55.003415, -2.098948], markerOptions('FallowfielDeneCaravanCampingPark', 25, 'tent'));
      FallowfielDeneCaravanCampingParkMarker.addTo(map);

      var CoastCastlesHolidayCampSideMarker = new L.Marker([55.426304, -1.606282], markerOptions('CoastCastlesHolidayCampSide', 25, 'tent'));
      CoastCastlesHolidayCampSideMarker.addTo(map);

      var TheNewInnMarker = new L.Marker([54.290741, -0.840936], markerOptions('TheNewInn', 25, 'tent'));
      TheNewInnMarker.addTo(map);

      var WhiteCottageHolidayParkMarker = new L.Marker([53.890897, -0.179570], markerOptions('WhiteCottageHolidayPark', 25, 'tent'));
      WhiteCottageHolidayParkMarker.addTo(map);

      var RobRoyGuesthouseMarker = new L.Marker([51.08892874373544, 1.188542346902516], markerOptions('RobRoyGuesthouse', 25, 'B&B'));
      RobRoyGuesthouseMarker.addTo(map);

      function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
          } else {
            alert("Geolocation is not supported by this browser.");
          }
        }
        
        function showPosition(position) {
            var wijMarker = new L.Marker([position.coords.latitude, position.coords.longitude], markerOptions('We are here', 25, 'wij'));
            wijMarker.addTo(map);
            map.setView([position.coords.latitude, position.coords.longitude], 15)
        }
        getLocation()

        function handleLocation(position) {
          doPost(position.coords.longitude, position.coords.latitude, 'test', 0)
        }

        function showPopup() {
            navigator.geolocation.getCurrentPosition(handleLocation)
        }

        function doPost(long, lat, desc, listSize) {
            let xhr = new XMLHttpRequest();
            xhr.open("POST", "https://omkdmr8fa6.execute-api.eu-west-1.amazonaws.com/prod/locations");

            xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                console.log(xhr.status);
                console.log(xhr.responseText);
            }};

           let data =  {
                "TableName": "Locations",
                "Item": {
                    "id": 0,
                    "Longitude":long,
                    "Latitude":lat,
                    "Beschrijving":desc,
                    "Tijdstip": Date.now().toLocaleString(),
                    "TijdstipEpoch": Date.now(),
                }
            }

        xhr.send(JSON.stringify(data));
        }

        document.getElementById('location').addEventListener("click", getLocation)
        document.getElementById('update').addEventListener("click", showPopup)

        function uuidv4() {
          return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
          (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
        );
}
    </script>
    <script>
        var x = document.getElementById("gps");
        function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
          } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
          }
        }
        
        function showPosition(position) {
          x.innerHTML = "Latitude: " + position.coords.latitude +
          "<br>Longitude: " + position.coords.longitude;
        }        

    </script>
    <script>
    </script>
  </body>
</html>